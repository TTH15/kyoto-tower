# Googleスプレッドシート連携セットアップ手順

## 概要
このガイドでは、京都タワー SANDO バル アンケートアプリとGoogleスプレッドシートを連携させる手順を説明します。

## セットアップ手順

### 1. Googleスプレッドシートの作成

1. [Google Sheets](https://sheets.google.com) にアクセス
2. 新しいスプレッドシートを作成
3. スプレッドシートのIDをメモ（URLの `https://docs.google.com/spreadsheets/d/【この部分】/edit` の部分）

### 2. Google Apps Script の設定

1. スプレッドシートから「拡張機能」→「Apps Script」を選択
2. `gas-script.js` の内容をコピーして貼り付け
3. `SPREADSHEET_ID` を実際のスプレッドシートIDに変更
```javascript
const SPREADSHEET_ID = 'あなたのスプレッドシートID';
```

### 3. Apps Script のデプロイ

1. Apps Script エディターで「デプロイ」→「新しいデプロイ」を選択
2. 「種類」で「ウェブアプリ」を選択
3. 設定：
   - **説明**: `京都タワーアンケートAPI`
   - **実行ユーザー**: `自分`
   - **アクセスできるユーザー**: `全員`
4. 「デプロイ」をクリック
5. 表示されるWebアプリのURLをコピー

### 4. フロントエンドの設定

1. `forms/script.js` の `GAS_WEB_APP_URL` を更新
```javascript
const GAS_WEB_APP_URL = 'あなたのWebアプリURL';
```

### 5. 初期データの設定

1. Apps Script エディターで `initializeSpreadsheet` 関数を実行
   - 関数を選択して「実行」ボタンをクリック
   - 初回実行時は権限の承認が必要です
2. スプレッドシートに3つのシートが自動作成されます：
   - **回答データ**: アンケート結果が保存されます
   - **ガチャ設定**: 賞品と確率を設定できます
   - **翻訳データ**: 多言語対応のテキストを管理できます

## スプレッドシートの構造

### 回答データシート
| タイムスタンプ | 出身 | SANDO バルを知った方法 | 来日前のリサーチ方法 | 来日後のリサーチ方法 | 言語 | IPアドレス |
|---------------|------|----------------------|-------------------|-------------------|------|-----------|
| 2024-01-01... | 東京 | SNS | Google検索 | Google マップ | ja | unknown |

### ガチャ設定シート
| 賞品名 | 画像 | レア度 | 説明 | 確率(%) |
|--------|------|--------|------|---------|
| 京都タワー展望券 | 🏯 | レア | 京都タワーの展望台無料券をゲット！ | 10 |
| SANDO バル 500円クーポン | 🍜 | ノーマル | 地下フードコートで使える500円分のクーポン！ | 30 |

### 翻訳データシート
| キー | 日本語 | 英語 | フランス語 | 中国語 | 韓国語 | ベトナム語 | インドネシア語 |
|------|--------|------|-----------|--------|--------|-----------|---------------|
| title | 京都タワー SANDO バル | Kyoto Tower SANDO Bar | Tour de Kyoto SANDO Bar | 京都塔 SANDO 酒吧 | 교토타워 SANDO 바 | Tháp Kyoto SANDO Bar | Menara Kyoto SANDO Bar |

## カスタマイズ方法

### ガチャ確率の調整
1. スプレッドシートの「ガチャ設定」シートを開く
2. 確率(%)の列で各賞品の当選確率を変更
3. 確率の合計は100%になるようにしてください

### 翻訳の編集
1. スプレッドシートの「翻訳データ」シートを開く
2. 各言語の列でテキストを編集
3. 新しい翻訳キーを追加する場合は、HTMLの `data-lang` 属性も更新してください

### 新しい賞品の追加
1. スプレッドシートの「ガチャ設定」シートで新しい行を追加
2. 必要な情報（賞品名、画像、レア度、説明、確率）を入力

## トラブルシューティング

### よくある問題

1. **「データを読み込み中...」が長時間続く**
   - WebアプリURLが正しく設定されているか確認
   - Apps Scriptが正しくデプロイされているか確認

2. **アンケート結果が保存されない**
   - Apps Scriptの実行権限を確認
   - スプレッドシートIDが正しいか確認

3. **翻訳が反映されない**
   - スプレッドシートの「翻訳データ」シートの形式を確認
   - ブラウザのキャッシュをクリア

### パフォーマンス最適化

- 翻訳データは初回読み込み時のみ取得され、その後はキャッシュが使用されます
- ガチャ設定も同様にキャッシュされるため、変更後はページを再読み込みしてください
- アンケート結果の保存は非同期で行われるため、ユーザー体験に影響しません

## セキュリティ注意点

- WebアプリのURLは誰でもアクセス可能ですが、スプレッドシートの閲覧・編集権限は別途管理されます
- 本番環境では、必要に応じてWebアプリのアクセス制限を設定してください
- 個人情報を含むアンケートの場合は、適切なプライバシー保護措置を講じてください

## サポート

問題が発生した場合は、以下を確認してください：
1. ブラウザの開発者ツールでエラーメッセージを確認
2. Apps Script のログでエラーを確認
3. スプレッドシートの権限設定を確認